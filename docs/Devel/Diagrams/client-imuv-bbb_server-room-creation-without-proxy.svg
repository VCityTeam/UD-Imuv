<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="838px" preserveAspectRatio="none" style="width:1229px;height:838px;background:#FFFFFF;" version="1.1" viewBox="0 0 1229 838" width="1229px" zoomAndPan="magnify"><defs><filter height="300%" id="f1p14ok4jqarit" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="791.8125" style="stroke:#A80036;stroke-width:1.0;" width="467" x="451" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="51" x="659" y="56.7329">IMUV</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="421" x="404" y="28.708">Imuv BBB server connection and room creation</text><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="70.2656" style="stroke:#000000;stroke-width:2.0;" width="548" x="227" y="162.125"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="356" x="227" y="279.5234"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="172.7969" style="stroke:#000000;stroke-width:2.0;" width="988" x="227" y="382.9219"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="172.7969" style="stroke:#000000;stroke-width:2.0;" width="1114" x="65" y="573.7188"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="641.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="76" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="243" x2="243" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="641.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="238" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="510" x2="510" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="502.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="505" y="267.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="644" x2="644" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="399.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="639" y="370.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="759" x2="759" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="620.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="754" y="150.125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="882" x2="882" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="641.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1163" x2="1163" y1="120.9922" y2="770.5156"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="641.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1158" y="128.9922"/><rect fill="#FFFFFF" filter="url(#f1p14ok4jqarit)" height="310.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1163" y="460.3203"/><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="5" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="12" y="88.4502">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="63" y="105.6904">Alice</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="167" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="174" y="88.4502">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="227" y="105.6904">Bob</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="106" x="455" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="92" x="462" y="104.7471">socket.io</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="108" x="588" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="94" x="595" y="88.4502">World #1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="612.5" y="105.6904">(Thread)</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="94" x="710" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="80" x="717" y="104.7471">express</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="60" x="850" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="46" x="857" y="104.7471">Core</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="68" x="1127" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1134" y="88.4502">B B B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1139" y="105.6904">Server</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="5" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="12" y="794.2236">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="63" y="811.4639">Alice</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="167" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="174" y="794.2236">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="227" y="811.4639">Bob</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="106" x="455" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="92" x="462" y="794.2236">socket.io</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="108" x="588" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="94" x="595" y="794.2236">World #1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="612.5" y="811.4639">(Thread)</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="94" x="710" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="80" x="717" y="794.2236">express</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="60" x="850" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="46" x="857" y="794.2236">Core</text><rect fill="#FEFECE" filter="url(#f1p14ok4jqarit)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="68" x="1127" y="770.5156"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1134" y="794.2236">B B B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1139" y="811.4639">Server</text><polygon fill="#A80036" points="775,146.125,765,150.125,775,154.125,771,150.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="769" x2="876" y1="150.125" y2="150.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="781" y="145.0591">New</text><path d="M227,162.125 L432,162.125 L432,169.125 L422,179.125 L227,179.125 L227,162.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="70.2656" style="stroke:#000000;stroke-width:2.0;" width="548" x="227" y="162.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="242" y="175.1919">Client code download</text><polygon fill="#A80036" points="742,206.3906,752,210.3906,742,214.3906,746,210.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="748" y1="210.3906" y2="210.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="255" y="205.3247">http:// GET ...</text><polygon fill="#A80036" points="259,220.3906,249,224.3906,259,228.3906,255,224.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="253" x2="753" y1="224.3906" y2="224.3906"/><polygon fill="#A80036" points="526,263.5234,516,267.5234,526,271.5234,522,267.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="876" y1="267.5234" y2="267.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="532" y="262.4575">New</text><path d="M227,279.5234 L567,279.5234 L567,286.5234 L557,296.5234 L227,296.5234 L227,279.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="356" x="227" y="279.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="295" x="242" y="292.5903">WebSocket bi-directional establishment</text><polygon fill="#A80036" points="259,323.7891,249,327.7891,259,331.7891,255,327.7891" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="493,323.7891,503,327.7891,493,331.7891,497,327.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="499" y1="327.7891" y2="327.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="265" y="322.7231">wss://</text><polygon fill="#A80036" points="660,366.9219,650,370.9219,660,374.9219,656,370.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="876" y1="370.9219" y2="370.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="666" y="365.856">New</text><path d="M227,382.9219 L646,382.9219 L646,389.9219 L636,399.9219 L227,399.9219 L227,382.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="172.7969" style="stroke:#000000;stroke-width:2.0;" width="988" x="227" y="382.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="374" x="242" y="395.9888">Bob enters room and triggers room establishment</text><polygon fill="#A80036" points="493,427.1875,503,431.1875,493,435.1875,497,431.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="499" y1="431.1875" y2="431.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="255" y="426.1216">wss:// JOIN_ROOM (roomId)</text><polygon fill="#A80036" points="865,427.1875,875,431.1875,865,435.1875,869,431.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515" x2="871" y1="431.1875" y2="431.1875"/><polygon fill="#A80036" points="1151,456.3203,1161,460.3203,1151,464.3203,1155,460.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="887" x2="1157" y1="460.3203" y2="460.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="894" y="455.2544">http:// Create_Room</text><polygon fill="#A80036" points="898,485.4531,888,489.4531,898,493.4531,894,489.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="892" x2="1157" y1="489.4531" y2="489.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="904" y="484.3872">http:// data: Room_URL</text><polygon fill="#A80036" points="660,514.5859,650,518.5859,660,522.5859,656,518.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="876" y1="518.5859" y2="518.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="666" y="513.52">ADD_ROOM(data)</text><polygon fill="#A80036" points="526,514.5859,516,518.5859,526,522.5859,522,518.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="638" y1="518.5859" y2="518.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="532" y="513.52">World_State diff</text><polygon fill="#A80036" points="259,514.5859,249,518.5859,259,522.5859,255,518.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="504" y1="518.5859" y2="518.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="265" y="513.52">wss:// world_diff (contains new room)</text><polygon fill="#A80036" points="259,543.7188,249,547.7188,259,551.7188,255,547.7188" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1151,543.7188,1161,547.7188,1151,551.7188,1155,547.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="1157" y1="547.7188" y2="547.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="265" y="542.6528">BBB protocol suite TLS/https/WEBRTC/RTP/UDP...</text><path d="M65,573.7188 L617,573.7188 L617,580.7188 L607,590.7188 L65,590.7188 L65,573.7188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="172.7969" style="stroke:#000000;stroke-width:2.0;" width="1114" x="65" y="573.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="507" x="80" y="586.7856">Alice's world wandering leads to room where Bod is already present</text><polygon fill="#A80036" points="493,617.9844,503,621.9844,493,625.9844,497,621.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="86" x2="499" y1="621.9844" y2="621.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="93" y="616.9185">wss:// JOIN_ROOM (roomId)</text><polygon fill="#A80036" points="865,617.9844,875,621.9844,865,625.9844,869,621.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515" x2="871" y1="621.9844" y2="621.9844"/><polygon fill="#A80036" points="1151,647.1172,1161,651.1172,1151,655.1172,1155,651.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="887" x2="1157" y1="651.1172" y2="651.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="894" y="646.0513">http:// Create_Room (idem potent)</text><polygon fill="#A80036" points="898,676.25,888,680.25,898,684.25,894,680.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="892" x2="1157" y1="680.25" y2="680.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="904" y="675.1841">http:// data: Room_URL (already given)</text><polygon fill="#A80036" points="660,705.3828,650,709.3828,660,713.3828,656,709.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="876" y1="709.3828" y2="709.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="666" y="704.3169">ADD_ROOM(aleady_given_data)</text><polygon fill="#A80036" points="526,705.3828,516,709.3828,526,713.3828,522,709.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="638" y1="709.3828" y2="709.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="532" y="704.3169">World_State diff</text><polygon fill="#A80036" points="97,705.3828,87,709.3828,97,713.3828,93,709.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="91" x2="504" y1="709.3828" y2="709.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="103" y="704.3169">wss:// world_diff (contains new room)</text><polygon fill="#A80036" points="97,734.5156,87,738.5156,97,742.5156,93,738.5156" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1151,734.5156,1161,738.5156,1151,742.5156,1155,738.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="91" x2="1157" y1="738.5156" y2="738.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="103" y="733.4497">BBB protocol suite TLS/https/WEBRTC/RTP/UDP...</text><!--MD5=[8009adcd5a3085e6207d91fbeb659ac8]
@startuml
'For same line messages support
!pragma teoz true

title Imuv BBB server connection and room creation

participant WebBrowserAlice [
  =Web Browser
  Alice
]

participant WebBrowserBob [
  =Web Browser
  Bob
]

box =IMUV #LightBlue
  participant "=socket.io" as ImuvWebsocket 
  participant ImuvWorld [
    =World #1 
    (Thread)
  ]
  participant "=express" as ImuvExpress
  participant "=Core" as Imuv
end box

participant BBB [
  =B B B
  Server
]

activate WebBrowserAlice
activate WebBrowserBob
activate Imuv
activate BBB

ImuvExpress <- Imuv: New
activate ImuvExpress
group Client code download
  WebBrowserBob -> ImuvExpress: http:// GET ...
  WebBrowserBob <- - ImuvExpress: 
end

ImuvWebsocket <- Imuv: New
activate ImuvWebsocket
group WebSocket bi-directional establishment
  WebBrowserBob <-> ImuvWebsocket: wss://
end

ImuvWorld <- Imuv: New
activate ImuvWorld
group Bob enters room and triggers room establishment
  WebBrowserBob -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> Imuv
  Imuv ->  BBB : http:// Create_Room
  activate BBB
  Imuv <- - BBB : http:// data: Room_URL
  ImuvWorld <- Imuv: ADD_ROOM(data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserBob <- ImuvWebsocket: wss:// world_diff (contains new room)
  WebBrowserBob <-> BBB: BBB protocol suite TLS/https/WEBRTC/RTP/UDP...
end

group Alice's world wandering leads to room where Bod is already present
  WebBrowserAlice -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> Imuv
  Imuv ->  BBB : http:// Create_Room (idem potent)
  Imuv <- - BBB : http:// data: Room_URL (already given)
  ImuvWorld <- Imuv: ADD_ROOM(aleady_given_data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserAlice <- ImuvWebsocket: wss:// world_diff (contains new room)
  WebBrowserAlice <-> BBB: BBB protocol suite TLS/https/WEBRTC/RTP/UDP...
end

@enduml

@startuml
!pragma teoz true

title Imuv BBB server connection and room creation

participant WebBrowserAlice [
  =Web Browser
  Alice
]

participant WebBrowserBob [
  =Web Browser
  Bob
]

box =IMUV #LightBlue
  participant "=socket.io" as ImuvWebsocket 
  participant ImuvWorld [
    =World #1 
    (Thread)
  ]
  participant "=express" as ImuvExpress
  participant "=Core" as Imuv
end box

participant BBB [
  =B B B
  Server
]

activate WebBrowserAlice
activate WebBrowserBob
activate Imuv
activate BBB

ImuvExpress <- Imuv: New
activate ImuvExpress
group Client code download
  WebBrowserBob -> ImuvExpress: http:// GET ...
  WebBrowserBob <- - ImuvExpress: 
end

ImuvWebsocket <- Imuv: New
activate ImuvWebsocket
group WebSocket bi-directional establishment
  WebBrowserBob <-> ImuvWebsocket: wss://
end

ImuvWorld <- Imuv: New
activate ImuvWorld
group Bob enters room and triggers room establishment
  WebBrowserBob -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> Imuv
  Imuv ->  BBB : http:// Create_Room
  activate BBB
  Imuv <- - BBB : http:// data: Room_URL
  ImuvWorld <- Imuv: ADD_ROOM(data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserBob <- ImuvWebsocket: wss:// world_diff (contains new room)
  WebBrowserBob <-> BBB: BBB protocol suite TLS/https/WEBRTC/RTP/UDP...
end

group Alice's world wandering leads to room where Bod is already present
  WebBrowserAlice -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> Imuv
  Imuv ->  BBB : http:// Create_Room (idem potent)
  Imuv <- - BBB : http:// data: Room_URL (already given)
  ImuvWorld <- Imuv: ADD_ROOM(aleady_given_data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserAlice <- ImuvWebsocket: wss:// world_diff (contains new room)
  WebBrowserAlice <-> BBB: BBB protocol suite TLS/https/WEBRTC/RTP/UDP...
end

@enduml

PlantUML version 1.2022.1(Tue Feb 01 18:19:58 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>