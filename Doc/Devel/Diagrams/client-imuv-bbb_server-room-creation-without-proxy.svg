<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="693px" preserveAspectRatio="none" style="width:1098px;height:693px;background:#FFFFFF;" version="1.1" viewBox="0 0 1098 693" width="1098px" zoomAndPan="magnify"><defs><filter height="300%" id="f3okbw3t5oheu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="646.1484" style="stroke:#A80036;stroke-width:1.0;" width="435" x="451" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="51" x="643" y="56.7329">IMUV</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="421" x="338.5" y="28.708">Imuv BBB server connection and room creation</text><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="70.2656" style="stroke:#000000;stroke-width:2.0;" width="548" x="227" y="162.125"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="356" x="227" y="279.5234"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="114.5313" style="stroke:#000000;stroke-width:2.0;" width="857" x="227" y="382.9219"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="85.3984" style="stroke:#000000;stroke-width:2.0;" width="821" x="227" y="515.4531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="495.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="76" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="243" x2="243" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="495.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="238" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="510" x2="510" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="357.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="505" y="267.5234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="644" x2="644" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="253.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="639" y="370.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="759" x2="759" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="474.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="754" y="150.125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="850" x2="850" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="495.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="845" y="128.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1032" x2="1032" y1="120.9922" y2="624.8516"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="495.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1027" y="128.9922"/><rect fill="#FFFFFF" filter="url(#f3okbw3t5oheu)" height="193.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1032" y="431.1875"/><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="5" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="12" y="88.4502">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="63" y="105.6904">Alice</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="167" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="174" y="88.4502">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="227" y="105.6904">Bob</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="106" x="455" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="92" x="462" y="104.7471">socket.io</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="108" x="588" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="94" x="595" y="88.4502">World #1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="612.5" y="105.6904">(Thread)</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="94" x="710" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="80" x="717" y="104.7471">express</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="60" x="818" y="81.0391"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="46" x="825" y="104.7471">Core</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="68" x="996" y="64.7422"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1003" y="88.4502">B B B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1008" y="105.6904">Server</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="5" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="12" y="648.5596">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="63" y="665.7998">Alice</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="148" x="167" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="134" x="174" y="648.5596">Web Browser</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="227" y="665.7998">Bob</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="106" x="455" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="92" x="462" y="648.5596">socket.io</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="108" x="588" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="94" x="595" y="648.5596">World #1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="612.5" y="665.7998">(Thread)</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="94" x="710" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="80" x="717" y="648.5596">express</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="34.9531" style="stroke:#A80036;stroke-width:1.5;" width="60" x="818" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="46" x="825" y="648.5596">Core</text><rect fill="#FEFECE" filter="url(#f3okbw3t5oheu)" height="51.25" style="stroke:#A80036;stroke-width:1.5;" width="68" x="996" y="624.8516"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1003" y="648.5596">B B B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1008" y="665.7998">Server</text><polygon fill="#A80036" points="775,146.125,765,150.125,775,154.125,771,150.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="769" x2="844" y1="150.125" y2="150.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="781" y="145.0591">New</text><path d="M227,162.125 L432,162.125 L432,169.125 L422,179.125 L227,179.125 L227,162.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="70.2656" style="stroke:#000000;stroke-width:2.0;" width="548" x="227" y="162.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="242" y="175.1919">Client code download</text><polygon fill="#A80036" points="742,206.3906,752,210.3906,742,214.3906,746,210.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="748" y1="210.3906" y2="210.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="255" y="205.3247">http:// GET ...</text><polygon fill="#A80036" points="259,220.3906,249,224.3906,259,228.3906,255,224.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="253" x2="753" y1="224.3906" y2="224.3906"/><polygon fill="#A80036" points="526,263.5234,516,267.5234,526,271.5234,522,267.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="844" y1="267.5234" y2="267.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="532" y="262.4575">New</text><path d="M227,279.5234 L567,279.5234 L567,286.5234 L557,296.5234 L227,296.5234 L227,279.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="356" x="227" y="279.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="295" x="242" y="292.5903">WebSocket bi-directional establishment</text><polygon fill="#A80036" points="259,323.7891,249,327.7891,259,331.7891,255,327.7891" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="493,323.7891,503,327.7891,493,331.7891,497,327.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="499" y1="327.7891" y2="327.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="265" y="322.7231">wss://</text><polygon fill="#A80036" points="660,366.9219,650,370.9219,660,374.9219,656,370.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="844" y1="370.9219" y2="370.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="666" y="365.856">New</text><path d="M227,382.9219 L504,382.9219 L504,389.9219 L494,399.9219 L227,399.9219 L227,382.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="114.5313" style="stroke:#000000;stroke-width:2.0;" width="857" x="227" y="382.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232" x="242" y="395.9888">BBB (chat) room establishment</text><polygon fill="#A80036" points="1020,427.1875,1030,431.1875,1020,435.1875,1024,431.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="855" x2="1026" y1="431.1875" y2="431.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="862" y="426.1216">http:// Create_Room</text><polygon fill="#A80036" points="866,456.3203,856,460.3203,866,464.3203,862,460.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="860" x2="1026" y1="460.3203" y2="460.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="872" y="455.2544">http:// data: Room_URL</text><polygon fill="#A80036" points="660,485.4531,650,489.4531,660,493.4531,656,489.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="844" y1="489.4531" y2="489.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="666" y="484.3872">ADD_ROOM(data)</text><polygon fill="#A80036" points="526,485.4531,516,489.4531,526,493.4531,522,489.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="638" y1="489.4531" y2="489.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="532" y="484.3872">World_State diff</text><polygon fill="#A80036" points="259,485.4531,249,489.4531,259,493.4531,255,489.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="504" y1="489.4531" y2="489.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="265" y="484.3872">wss:// world_diff (contains new room)</text><path d="M227,515.4531 L717,515.4531 L717,522.4531 L707,532.4531 L227,532.4531 L227,515.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="85.3984" style="stroke:#000000;stroke-width:2.0;" width="821" x="227" y="515.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="445" x="242" y="528.52">Bob's world wandering leads to room where Alice already is</text><polygon fill="#A80036" points="493,559.7188,503,563.7188,493,567.7188,497,563.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="248" x2="499" y1="563.7188" y2="563.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="255" y="558.6528">wss:// JOIN_ROOM (roomId)</text><polygon fill="#A80036" points="627,559.7188,637,563.7188,627,567.7188,631,563.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515" x2="633" y1="563.7188" y2="563.7188"/><polygon fill="#A80036" points="259,588.8516,249,592.8516,259,596.8516,255,592.8516" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1020,588.8516,1030,592.8516,1020,596.8516,1024,592.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253" x2="1026" y1="592.8516" y2="592.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="265" y="587.7856">FIXME BBB protocol ?</text><!--MD5=[d2c17dc52597133cddcc3a134eb8a638]
@startuml
'For same line messages support
!pragma teoz true

title Imuv BBB server connection and room creation

participant WebBrowserAlice [
  =Web Browser
  Alice
]

participant WebBrowserBob [
  =Web Browser
  Bob
]

box =IMUV #LightBlue
  participant "=socket.io" as ImuvWebsocket 
  participant ImuvWorld [
    =World #1 
    (Thread)
  ]
  participant "=express" as ImuvExpress
  participant "=Core" as Imuv
end box

participant BBB [
  =B B B
  Server
]

activate WebBrowserAlice
activate WebBrowserBob
activate Imuv
activate BBB

ImuvExpress <- Imuv: New
activate ImuvExpress
group Client code download
  WebBrowserBob -> ImuvExpress: http:// GET ...
  WebBrowserBob <- - ImuvExpress: 
end

ImuvWebsocket <- Imuv: New
activate ImuvWebsocket
group WebSocket bi-directional establishment
  WebBrowserBob <-> ImuvWebsocket: wss://
end

ImuvWorld <- Imuv: New
activate ImuvWorld
group BBB (chat) room establishment
  Imuv ->  BBB : http:// Create_Room
  activate BBB
  Imuv <- - BBB : http:// data: Room_URL
  ImuvWorld <- Imuv: ADD_ROOM(data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserBob <- ImuvWebsocket: wss:// world_diff (contains new room)
end

group Bob's world wandering leads to room where Alice already is
  WebBrowserBob -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> ImuvWorld
  WebBrowserBob <-> BBB: FIXME BBB protocol ?
end

@enduml

@startuml
!pragma teoz true

title Imuv BBB server connection and room creation

participant WebBrowserAlice [
  =Web Browser
  Alice
]

participant WebBrowserBob [
  =Web Browser
  Bob
]

box =IMUV #LightBlue
  participant "=socket.io" as ImuvWebsocket 
  participant ImuvWorld [
    =World #1 
    (Thread)
  ]
  participant "=express" as ImuvExpress
  participant "=Core" as Imuv
end box

participant BBB [
  =B B B
  Server
]

activate WebBrowserAlice
activate WebBrowserBob
activate Imuv
activate BBB

ImuvExpress <- Imuv: New
activate ImuvExpress
group Client code download
  WebBrowserBob -> ImuvExpress: http:// GET ...
  WebBrowserBob <- - ImuvExpress: 
end

ImuvWebsocket <- Imuv: New
activate ImuvWebsocket
group WebSocket bi-directional establishment
  WebBrowserBob <-> ImuvWebsocket: wss://
end

ImuvWorld <- Imuv: New
activate ImuvWorld
group BBB (chat) room establishment
  Imuv ->  BBB : http:// Create_Room
  activate BBB
  Imuv <- - BBB : http:// data: Room_URL
  ImuvWorld <- Imuv: ADD_ROOM(data)
  &ImuvWorld -> ImuvWebsocket: World_State diff
  &WebBrowserBob <- ImuvWebsocket: wss:// world_diff (contains new room)
end

group Bob's world wandering leads to room where Alice already is
  WebBrowserBob -> ImuvWebsocket: wss:// JOIN_ROOM (roomId)
  &ImuvWebsocket -> ImuvWorld
  WebBrowserBob <-> BBB: FIXME BBB protocol ?
end

@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>